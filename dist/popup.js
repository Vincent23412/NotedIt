(()=>{"use strict";function t(t){return new Promise((e=>{chrome.storage.local.get(t,(n=>{e(n[t])}))}))}var e=function(t,e,n,o){return new(n||(n=Promise))((function(l,c){function i(t){try{d(o.next(t))}catch(t){c(t)}}function r(t){try{d(o.throw(t))}catch(t){c(t)}}function d(t){var e;t.done?l(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,r)}d((o=o.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("note-list"),e=document.getElementById("note"),l=document.getElementById("save-button");n(t),l.addEventListener("click",o(t,e))}));const n=(n,o="hostname")=>e(void 0,void 0,void 0,(function*(){const e=(yield t("notes"))||[];n.innerHTML="";const c=function(t,e){const n={};for(const o of t){const t=e(o);n[t]||(n[t]=[]),n[t].push(o)}return n}(e,(t=>{var e;return String(null!==(e=t[o])&&void 0!==e?e:"unsorted")}));console.log("分組後的筆記：",c);for(const[t,e]of Object.entries(c)){const o=document.createElement("div");o.style.marginBottom="16px";const c=document.createElement("h4");c.textContent=`🌐 ${t}`,c.style.marginBottom="6px",c.style.borderBottom="1px solid #ccc",c.style.paddingBottom="4px",o.appendChild(c),e.forEach((t=>{const e=l(t);o.appendChild(e)})),n.appendChild(o)}})),o=(o,l)=>()=>e(void 0,void 0,void 0,(function*(){var e,c,i;const r=l.value;if(!r)return;const[d,s]=yield Promise.all([t("notes"),chrome.tabs.query({active:!0,currentWindow:!0})]),a=(null===(e=s[0])||void 0===e?void 0:e.url)||"unknown",u=(null===(c=s[0])||void 0===c?void 0:c.favIconUrl)||"",m=d||[],p={title:(null===(i=s[0])||void 0===i?void 0:i.title)||"unknown",content:r,url:a,iconUrl:u,hostname:"unknown"!==a?new URL(a).hostname:"unknown",createdAt:Date.now()};var v;m.push(p),yield(v={notes:m},new Promise((t=>{chrome.storage.local.set(v,(()=>{t()}))}))),l.value="",n(o)})),l=t=>{const e=document.createElement("li");e.style.display="flex",e.style.flexDirection="column",e.style.marginBottom="10px",e.style.padding="6px",e.style.borderBottom="1px solid #ddd";const n=document.createElement("img");n.src=t.iconUrl||"icons/default-icon.png",n.alt="icon",n.width=16,n.height=16,n.style.marginRight="4px";const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="4px";const l=document.createElement("span");l.textContent=t.content,o.appendChild(n),o.appendChild(l);const c=document.createElement("a");return c.href=t.url,c.textContent=`🔗 ${t.url}`,c.target="_blank",c.style.fontSize="0.85em",c.style.color="#0066cc",c.style.textDecoration="underline",c.style.wordBreak="break-all",e.appendChild(o),e.appendChild(c),e}})();