(()=>{"use strict";function t(t){return new Promise((e=>{chrome.storage.local.get(t,(n=>{e(n[t])}))}))}function e(t){return new Promise((e=>{chrome.storage.local.set(t,(()=>{e()}))}))}var n=function(t,e,n,o){return new(n||(n=Promise))((function(i,c){function l(t){try{a(o.next(t))}catch(t){c(t)}}function d(t){try{a(o.throw(t))}catch(t){c(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,d)}a((o=o.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("note-list"),e=document.getElementById("note"),n=document.getElementById("save-button");o(t),n.addEventListener("click",i(t,e))}));const o=(e,i="tags")=>n(void 0,void 0,void 0,(function*(){const l=(yield t("notes"))||[];e.innerHTML="";const d=function(t,e){const n={};for(const o of t){const t=e(o),i=String(null!=t?t:"未分類");n[i]||(n[i]=[]),n[i].push(o)}return n}(l,(t=>{const e=t[i];return Array.isArray(e)?e.join(",")||"未分類":String(null!=e?e:"未分類")}));for(const[t,l]of Object.entries(d)){const d=document.createElement("li");if(d.className="note-item","url"===i){const e=document.createElement("a");e.href=t,e.textContent="🔗 前往網頁",e.target="_blank",e.className="note-url",e.style.marginBottom="6px",e.style.display="inline-block",d.appendChild(e)}else if("tags"===i){const e=document.createElement("div");e.textContent=`🏷️ Tag：${t}`,e.style.fontSize="13px",e.style.marginBottom="6px",e.style.fontWeight="bold",d.appendChild(e)}else{const e=document.createElement("div");e.textContent=`📁 ${i}: ${t}`,e.style.fontSize="13px",e.style.marginBottom="6px",d.appendChild(e)}l.forEach((t=>{const l=document.createElement("div");l.className="note-content";const a=document.createElement("img");a.src=t.iconUrl||"icons/default-icon.png",a.alt="icon",a.className="note-icon";const s=document.createElement("span");s.textContent=t.content;const r=document.createElement("button");r.textContent="🗑",r.className="note-delete-btn",r.addEventListener("click",(l=>n(void 0,void 0,void 0,(function*(){l.stopPropagation(),confirm("確定要刪除這筆筆記嗎？")&&(yield c(t.id),yield o(e,i))})))),l.appendChild(a),l.appendChild(s),l.appendChild(r),d.appendChild(l)})),e.appendChild(d)}})),i=(i,c)=>()=>n(void 0,void 0,void 0,(function*(){var n,l,d;const a=c.value;if(!a)return;const s=document.getElementById("tag-input").value.split(",").map((t=>t.trim())).filter((t=>""!==t)),[r,u]=yield Promise.all([t("notes"),chrome.tabs.query({active:!0,currentWindow:!0})]),m=(null===(n=u[0])||void 0===n?void 0:n.url)||"unknown",v=(null===(l=u[0])||void 0===l?void 0:l.favIconUrl)||"",p=r||[],f={id:`${m}-${a}`,title:(null===(d=u[0])||void 0===d?void 0:d.title)||"unknown",content:a,url:m,iconUrl:v,hostname:"unknown"!==m?new URL(m).hostname:"unknown",createdAt:Date.now(),tags:s};p.push(f),p.sort(((t,e)=>t.hostname.charCodeAt(0)-e.hostname.charCodeAt(0))),yield e({notes:p}),c.value="",o(i)})),c=o=>n(void 0,void 0,void 0,(function*(){const n=((yield t("notes"))||[]).filter((t=>t.id!==o));yield e({notes:n}),console.log(`已刪除筆記（id=${o}）`)}))})();